<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>HWChange</title>
</head>

<body>
    <div>
        <h4 style="text-align: center;"><B>Node</B></h4>
        <table border="1px" style="text-align: center;">
            <thead style="background-color: rgba(255, 222, 42); text-align: center;">
                <tr>
                    <td>Timestamp</td>
                    <td>IP</td>
                    <td>총 GPU 메모리 사용량(%)</td>
                    <td>총 GPU 메모리 사용량(MB)</td>
                    <td>사용 가능 Disk 양(GB)</td>
                    <td>사용 가능 Disk 양(%)</td>
                    <td>메모리 사용량(%)</td>
                    <td>사용 가능 메모리 양(GB)</td>
                    <td>CPU 사용량(%)</td>
                    <td>사용 가능 CPU 양(%)</td>
                </tr>
            </thead>
            <tbody style="text-align: center;">
                {% for result in node_result %}
                <tr>
                    <td>{{result.created_at}}</td>
                    <td>{{result.ip.ip}}</td>
                    <td>{{result.total_gpu_memory_using_percent}} </td>
                    <td>{{result.total_gpu_memory_using_mb}} MB</td>
                    <td>{{result.free_disk_gb}} GB</td>
                    <td>{{result.free_disk_percent}} </td>
                    <td>{{result.total_memory_using_percent}} </td>
                    <td>{{result.free_memory_gb}} GB</td>
                    <td>{{result.total_cpu_using_percent}} </td>
                    <td>{{result.free_cpu_percent}}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div>
        <h4 style="text-align: center;"><B>Disk</B></h4>
        <table border="1px">
            <thead style="background-color: rgba(255, 222, 42); text-align: center;">
                <tr>
                    <td>Timestamp</td>
                    <td>IP</td>
                    <td>디스크 경로</td>
                    <td>각 디스크 사용량(GB)</td>
                    <td>각 디스크 사용량(%)</td>
                </tr>
            </thead>
            <tbody style="text-align: center;">
                {% for result in disk_result %}
                <tr>
                    <td>{{result.create_at}}</td>
                    <td>{{result.ip.ip}}</td>
                    <td>{{result.disk_path}}</td>
                    <td>{{result.disk_using_gb}} GB</td>
                    <td>{{result.disk_using_percent}} </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div>
        <h4 style="text-align: center;"><B>GPU</B></h4>
        <table border="1px">
            <thead style="background-color: rgba(255, 222, 42); text-align: center;">
                <tr>
                    <td>Timestamp</td>
                    <td>IP</td>
                    <td>인덱스</td>
                    <td>각 GPU 메모리 사용량(MB)</td>
                    <td>각 GPU 메모리 사용량(%)</td>
                </tr>
            </thead>
            <tbody style="text-align: center;">
                {% for result in gpu_result %}
                <tr>
                    <td>{{result.created_at}}</td>
                    <td>{{result.ip.ip}}</td>
                    <td>{{result.gpu_index}}</td>
                    <td>{{result.gpu_memory_using_mb}} MB</td>
                    <td>{{result.gpu_memory_using_percent}} MB</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    intervals()

    function intervals() {
        setInterval(update, 8000)
    }

    function update() {

        console.log("Update")

        $.ajax({
            url: "http://127.0.0.1:8080/HW/load/",
            type: "get",
            dataType: "json",

            success: function (data) {

                if (JSON.stringify(data) != '{}') {

                    // node
                    var node_table = data['node_result']
                    for (var i = 0; i < node_table.length; i++) {
                        console.log(node_table[i])
                    }

                    // disk
                    var disk_table = data['disk_result']
                    for (var i = 0; i < disk_table.length; i++) {
                        console.log(disk_table[i])
                    }

                    // gpu
                    var gpu_table = data['gpu_result']
                    for (var i = 0; i < gpu_table.length; i++) {
                        console.log(gpu_table[i])
                    }
                }

            },

            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }



</script>

</html>